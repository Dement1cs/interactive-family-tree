{% extends "base.html" %}

<!-- разделение на муж и жен -->
{% macro role_label(kind, gender) -%}
    {%- set g = (gender or '')|lower -%}
    {%- if kind == 'parent' -%}
        {{ 'Father' if g == 'male' else ('Mother' if g == 'female' else 'Parent') }}
    {%- elif kind == 'child' -%}
        {{ 'Son' if g == 'male' else ('Daughter' if g == 'female' else 'Child') }}
    {%- elif kind == 'sibling' -%}
        {{ 'Brother' if g == 'male' else ('Sister' if g == 'female' else 'Sibling') }}
    {%- elif kind == 'grandparent' -%}
        {{ 'Grandfather' if g == 'male' else ('Grandmother' if g == 'female' else 'Grandparent') }}
    {%- else -%}
        Person
    {%- endif -%}
{%- endmacro %}

<!-- связи видемы и нет -->
<!--{% set has_any =
    (parents and parents|length>0) or
    (siblings and siblings|length>0) or
    (children and children|length>0) or
    (spouses and spouses|length>0) or
    (grandparents and grandparents|length>0)
%}

{% if not has_any %}
<p class="muted">No relations linked yet.</p>
{% endif %}-->

{% block title %}
    {{ person["first_name"] }} {{ person["last_name"] or "" }} — Profile
{% endblock %}

{% block content %}
<div class="person-actions" style="margin-bottom: 10px;">
    <a href="{{ url_for('edit_person', person_id=person['id']) }}">Edit</a>

    <form action="{{ url_for('delete_person_route', person_id=person['id']) }}"
          method="post"
          style="display:inline;"
          onsubmit="return confirm('Delete this person?');">
        <button type="submit">Delete</button>
    </form>
</div>

<div class="person-detail">

    <div class="person-header">
        <div class="person-avatar">
            <!-- заглушка -->
            <span class="avatar-initials">
                {{ person["first_name"][0] }}{% if person["last_name"] %}{{ person["last_name"][0] }}{% endif %}
            </span>
        </div>

        <div class="person-main-info">
            <h2>{{ person["first_name"] }} {{ person["last_name"] or "" }}</h2>

            <p class="person-dates">
                {% if person["birth_date"] %}
                    Born: {{ person["birth_date"] }}
                {% endif %}
                {% if person["death_date"] %}
                    &nbsp;•&nbsp; Died: {{ person["death_date"] }}
                {% endif %}
            </p>

            {% if person["gender"] %}
                <p class="person-gender">Gender: {{ person["gender"] }}</p>
            {% endif %}
        </div>
    </div>

    <div class="person-body">
        <section class="person-section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Relations</h3>
                <a href="{{ url_for('add_relation', person_id=person['id']) }}">Add relation</a>
            </div>

            {% if parents and parents|length > 0 %}
                <h4>Parents</h4>
                <ul>
                    {% for p in parents %}
                        <li>{{ role_label('parent', p['gender']) }}: <a href="{{ url_for('person_detail', person_id=p['id']) }}">{{ p['first_name'] }} {{ p['last_name'] }}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if siblings and siblings|length > 0 %}
                <h4>Siblings</h4>
                <ul>
                    {% for s in siblings %}
                        <li>{{ role_label('sibling', s['gender']) }}: <a href="{{ url_for('person_detail', person_id=s['id']) }}">{{ s['first_name'] }} {{ s['last_name'] }}</a></li>
                    {% endfor %}
                </ul>
            {% else %}
                <!--<p class="muted">No siblings detected.</p>-->
            {% endif %}

            {% if children and children|length > 0 %}
                <h4>Children</h4>
                <ul>
                    {% for c in children %}
                        <li>{{ role_label('child', c['gender']) }}: <a href="{{ url_for('person_detail', person_id=c['id']) }}">{{ c['first_name'] }} {{ c['last_name'] }}</a></li>
                    {% endfor %}
                </ul>
            {% else %}
                <!--<p class="muted">No children linked yet.</p>-->
            {% endif %}

            {% if spouses and spouses|length > 0 %}
                <h4>Spouse</h4>
                <ul>
                {% for s in spouses %}
                    <li>
                        <a href="{{ url_for('person_detail', person_id=s['id']) }}">
                            {{ s["first_name"] }} {{ s["last_name"] or "" }}
                        </a>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <!--<p class="muted">No spouse linked yet.</p>-->
            {% endif %}

            {% if grandparents and grandparents|length > 0 %}
            <h4>Grandparents</h4>
                <ul>
                    {% for g in grandparents %}
                        <li>{{ role_label('grandparent', g['gender']) }}: <a href="{{ url_for('person_detail', person_id=g['id']) }}">{{ g['first_name'] }} {{ g['last_name'] }}</a></li>
                    {% endfor %}
                </ul>
            {% else %}
                <!--<p class="muted">No grandparents detected.</p>
            {% endif %}
        </section>

        

        <!-- Description -->
        <section class="person-section">
            <h3>Description</h3>
            {% if person["notes"] %}
                <p>{{ person["notes"] }}</p>
            {% else %}
                <p class="muted">No description yet.</p>
            {% endif %}
        </section>

        <!-- Gallery -->
        <section class="person-section">
            <h3>Photo Gallery</h3>
            <p class="muted">
                Photo gallery placeholder. In the future this section can show uploaded photos.
            </p>
        </section>
    </div>

    <p>
        <a href="{{ url_for('persons') }}">← Back to list</a>
    </p>
</div>
{% endblock %}